<?xml version="1.0"?>
<pfsense>
    <system>
        <hostname>pfSense-NVA</hostname>
        <domain>local</domain>
        <timezone>Europe/Paris</timezone>
        <webgui>
            <protocol>http</protocol>
            <port>80</port>
        </webgui>
        <ssh>
            <enabled>enabled</enabled>
        </ssh>
    </system>
    <interfaces>
        <wan>
            <if>vtnet0</if>
            <descr>WAN</descr>
            <ipaddr>dhcp</ipaddr>
            <blockpriv>off</blockpriv>
            <blockbogons>off</blockbogons>
        </wan>
        <lan>
            <if>vtnet1</if>
            <descr>LAN</descr>
            <ipaddr>192.168.1.1</ipaddr>
            <subnet>24</subnet>
        </lan>
        <opt1>
            <if>vtnet2</if>
            <descr>OPT1</descr>
            <ipaddr>192.168.2.1</ipaddr>
            <subnet>24</subnet>
        </opt1>
        <opt2>
            <if>vtnet3</if>
            <descr>OPT2</descr>
            <ipaddr>192.168.3.1</ipaddr>
            <subnet>24</subnet>
        </opt2>
        <wg0>
            <enable/>
            <descr>WireGuard_VPN_Tunnel</descr>
            <interface>wg0</interface>
            <ipaddr>10.6.210.1</ipaddr> <subnet>31</subnet>
            <config>
                <listenport>51820</listenport>
                </config>
        </wg0>
    </interfaces>
    <dhcpd>
        <lan>
            <enable/>
            <range>
                <from>192.168.1.100</from>
                <to>192.168.1.200</to>
            </range>
            <defaultleasetime>7200</defaultleasetime>
            <maxleasetime>86400</maxleasetime>
            <dnsserver>192.168.1.1</dnsserver>
            <dnsserver>8.8.8.8</dnsserver>
        </lan>
        <opt1>
            <enable/>
            <range>
                <from>192.168.2.100</from>
                <to>192.168.2.200</to>
            </range>
            <defaultleasetime>7200</defaultleasetime>
            <maxleasetime>86400</maxleasetime>
            <dnsserver>192.168.2.1</dnsserver>
            <dnsserver>8.8.8.8</dnsserver>
        </opt1>
    </dhcpd>
    <installedpackages>
        <package>
            <name>frr</name>
            <descr>FRRouting Dynamic Routing Suite</descr>
            <config>
                <ospfd>
                    <enable>on</enable>
                    <routerid>192.168.1.1</routerid> <network>
                        <item>
                            <network>192.168.1.0/24</network>
                            <area>0.0.0.0</area>
                        </item>
                        <item>
                            <network>192.168.2.0/24</network>
                            <area>0.0.0.0</area>
                        </item>
                        <item>
                            <network>10.6.210.0/31</network> <area>0.0.0.0</area>
                        </item>
                    </network>
                    <redistribute>
                        <item>
                            <type>connected</type>
                        </item>
                    </redistribute>
                    <interface>
                        <item>
                            <name>lan</name>
                            <type>network</type>
                            <area>0.0.0.0</area>
                        </item>
                        <item>
                            <name>opt1</name>
                            <type>network</type>
                            <area>0.0.0.0</area>
                        </item>
                        <item>
                            <name>wg0</name> <type>network</type>
                            <area>0.0.0.0</area>
                        </item>
                    </interface>
                </ospfd>
                <zebra>
                    <enable>on</enable>
                </zebra>
                <ospf6d>
                    <enable>off</enable>
                </ospf6d>
                <bgpd>
                    <enable>off</enable>
                </bgpd>
                <ripd>
                    <enable>off</enable>
                </ripd>
                <ripngd>
                    <enable>off</enable>
                </ripngd>
            </config>
        </package>
        <package>
            <name>wireguard</name>
            <descr>WireGuard VPN</descr>
            </package>
        <package>
            <name>net-snmp</name>
            <descr>Net-SNMP daemon and utilities</descr>
            <config>
                <snmpd>
                    <enable>on</enable>
                    <bindip>0.0.0.0</bindip> <community>public</community> <privports>off</privports>
                    <readcommunity>public</readcommunity>
                </snmpd>
            </config>
        </package>
    </installedpackages>
    <filter>
        <rule>
            <type>pass</type>
            <interface>wan</interface>
            <protocol>89</protocol>
            <source>
                <any/>
            </source>
            <destination>
                <any/>
            </destination>
            <descr>Allow OSPF on WAN</descr>
        </rule>
        <rule>
            <type>pass</type>
            <interface>opt1</interface>
            <protocol>89</protocol>
            <source>
                <any/>
            </source>
            <destination>
                <any/>
            </destination>
            <descr>Allow OSPF on OPT1</descr>
        </rule>
        <rule>
            <type>pass</type>
            <interface>wg0</interface> <protocol>89</protocol>
            <source>
                <any/>
            </source>
            <destination>
                <any/>
            </destination>
            <descr>Allow OSPF on WireGuard Interface</descr>
        </rule>
        <rule>
            <type>pass</type>
            <interface>wan</interface>
            <protocol>udp</protocol>
            <source>
                <any/>
            </source>
            <destination>
                <address>wan</address>
                <port>51820</port>
            </destination>
            <descr>Allow WireGuard UDP on WAN</descr>
        </rule>
        <rule>
            <type>pass</type>
            <interface>lan</interface>
            <protocol>any</protocol>
            <source>
                <network>lan</network>
            </source>
            <destination>
                <any/>
            </destination>
            <descr>Default allow LAN to any</descr>
        </rule>
        <rule>
            <type>pass</type>
            <interface>opt1</interface>
            <protocol>any</protocol>
            <source>
                <network>opt1</network>
            </source>
            <destination>
                <any/>
            </destination>
            <descr>Default allow OPT1 to any</descr>
        </rule>
        <rule>
            <type>pass</type>
            <interface>opt2</interface>
            <protocol>any</protocol>
            <source>
                <network>opt2</network>
            </source>
            <destination>
                <any/>
            </destination>
            <descr>Default allow OPT2 to any</descr>
        </rule>
        <rule>
            <type>pass</type>
            <interface>wg0</interface>
            <protocol>any</protocol>
            <source>
                <network>wg0</network>
            </source>
            <destination>
                <any/>
            </destination>
            <descr>Allow WireGuard traffic out of tunnel</descr>
        </rule>
        <rule>
            <type>pass</type>
            <interface>opt2</interface>
            <protocol>udp</protocol>
            <source>
                <address>192.168.3.10</address> </source>
            <destination>
                <address>opt2</address>
                <port>161</port>
            </destination>
            <descr>Allow SNMP from Monitoring Server</descr>
        </rule>
    </filter>
    <nat>
        <outbound>
            <mode>manual</mode>
            <rule>
                <interface>wan</interface>
                <source>
                    <network>lan</network>
                </source>
                <destination>
                    <any/>
                </destination>
                <target>wanip</target>
                <descr>NAT LAN to WAN</descr>
            </rule>
            <rule>
                <interface>wan</interface>
                <source>
                    <network>opt1</network>
                </source>
                <destination>
                    <any/>
                </destination>
                <target>wanip</target>
                <descr>NAT OPT1 to WAN</descr>
            </rule>
            <rule>
                <interface>wan</interface>
                <source>
                    <network>opt2</network>
                </source>
                <destination>
                    <any/>
                </destination>
                <target>wanip</target>
                <descr>NAT OPT2 to WAN</descr>
            </rule>
        </outbound>
    </nat>
</pfsense>